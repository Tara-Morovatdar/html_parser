AdsPlugin=function(){function o(e){window.performance&&performance.mark&&performance.mark(e)}function t(e){o("ad-manager-loaded"),d.dispatchEvent({type:ge,id:"adManagerLoaded"});var t=new google.ima.AdsRenderingSettings;t.disableUi=!0,t.uiElements=[],t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.useStyledLinearAds=!0,(F=e.getAdsManager(p,t)).addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,He),F.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,Fe),F.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,je),F.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,Ve),F.addEventListener(google.ima.AdEvent.Type.LOADED,Oe),F.addEventListener(google.ima.AdEvent.Type.COMPLETE,Ue),F.addEventListener(google.ima.AdEvent.Type.STARTED,Re),F.addEventListener(google.ima.AdEvent.Type.CLICK,We),F.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,Be),F.addEventListener(google.ima.AdEvent.Type.IMPRESSION,xe),F.addEventListener(google.ima.AdEvent.Type.LOG,De),F.addEventListener(google.ima.AdEvent.Type.PAUSED,we),F.addEventListener(google.ima.AdEvent.Type.RESUMED,Me);try{F.init(b.clientWidth,b.clientHeight,google.ima.ViewMode.NORMAL),F.start()}catch(e){Ge()}}function i(e,t,n){var a=document.createElement(e);return a.id=t,n.appendChild(a),a}function s(e,t,n,a,i,o,s){var d=document.createElement("button");d.id=e,d.className=t,d.title=n;var l=document.createElement("span");l.className="ads_hiddenElement",l.innerHTML=n,l.setAttribute("aria-hidden","true"),d.appendChild(l);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",a),r.setAttribute("height",i),r.setAttribute("viewBox",o);var u=document.createElementNS("http://www.w3.org/2000/svg","use");return u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s),r.appendChild(u),d.appendChild(r),d}function n(){At(),o("ad-sdk-loaded"),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(K),p=d.requestVideoElement(!0),U=window.Device&&Device.iPhoneOutOfPagePlayback?new google.ima.AdDisplayContainer(b):(google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),new google.ima.AdDisplayContainer(b,p)),(H=new google.ima.AdsLoader(U)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,t),H.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,je),d.listenerObject={playlistLoading:he,playlistLoaded:be,userPlay:Le,playing:Se,ended:ke,resize:_e,fullscreenEnter:fe,fullscreenExit:Ae,error:Te,"bbc.smp.plugins.ads.event.updateAdTag":Ne,"bbc.smp.plugins.preview.complete":ye,pluginLoaded:Ee};var e=d.playlist;e&&be({playlist:e}),d.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.4.7.1")}var d,a,l,r,u,c,g,p,m,v,E,y,f,A,h,T,b,L,S,k,_,C,N,P,I,w,M,D,O,B,R,x,U,H,F,e=/windows phone/i.test(navigator.userAgent),V=/iPhone/i.test(navigator.userAgent)&&!e,j=/iPod/i.test(navigator.userAgent)&&!e,G=!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)),W=!1,z=!1,q=[],K="en",Y=Number.POSITIVE_INFINITY,Q=function(){},Z=!1,$=!1,X=!1,J=!1,ee=!1,te=!1,ne=!1,ae=!1,ie=!0,oe=!1,se=!1,de=!1,le=!1,re=!1,ue=!1,ce=!1,ge="adsPlugin",pe="adError",me="adDuration",ve={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÉCLAME",de:"ANKÜNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"広告",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},Ee=function(e){-1===e.url.indexOf("dfpAds")&&(q=d.datastore.get("plugins").slice()),ht()},ye=function(e){(le=!0)!==m.hasAds&&!0!==W||(Z=!0,Pe())},fe=function(e){ae=!0,ze(C,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),g=setTimeout(Ce,510)},Ae=function(e){ae=!1,ze(C,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),g=setTimeout(Ce,510)},he=function(e){Ge(!0),m=null,se=ue=re=le=ne=te=ee=J=X=oe=$=Z=!1,Y=Number.POSITIVE_INFINITY,ce=!1,clearInterval(E),clearInterval(y),clearInterval(c)},Te=function(e){"critical"==e.severity&&he()},be=function(e){m||!0!==(m=e.playlist).hasAds&&!0!==W||(Z=!0,Pe())},Le=function(e){!0===Z&&!1===X&&(o("ad-container-init"),U.initialize(),oe=!0)},Se=function(e){de&&!le||!0===Z&&!1===X&&(oe||(oe=!0,o("ad-container-init2"),U.initialize()),Ie())},ke=function(e){(ne=!0)===Z&&!1===te?(ie=!1,Qe(),Ze(T),H.contentComplete()):(V||j)&&p.webkitExitFullScreen()},_e=function(e){Ce()},Ce=function(){F&&F.resize(b.clientWidth,b.clientHeight,ae?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},Ne=function(e){a=e.data.adTag},Pe=function(){de&&!le||(d.pauseAt([0]),$||($=!0,Q()))},Ie=function(){o("ad-request"),ie=!1,Qe(),Ze(T),d.datastore.set({name:"adsPlaying",data:!0});var e=new google.ima.AdsRequest;e.adTagUrl=a,e.linearAdSlotWidth=b.clientWidth,e.linearAdSlotHeight=b.clientHeight,e.nonLinearAdSlotWidth=b.clientWidth,e.nonLinearAdSlotHeight=b.clientHeight,H.requestAds(e),d.dispatchEvent({type:ge,id:"adRequest"}),X=!0},we=function(e){ze(k,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(E),clearInterval(y),J=!0},Me=function(e){!0===J&&(ze(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),E=setInterval(nt,250),f.isSkippable&&0<Y&&ce&&(y=setInterval(tt,250)),J=!1)},De=function(e){var t=e.getAdData();if(t&&t.adError){var n=t.adError;d.dispatchEvent({type:ge,id:pe,code:n.getErrorCode(),msg:n.getMessage()})}},Oe=function(e){o("ad-loaded");var t=e.getAd();v=t.getDuration(),d.dispatchEvent({type:ge,id:me,duration:v});e.getAdData()},Be=function(e){0<e.getAd().getDuration()&&(v=e.getAd().getDuration(),d.dispatchEvent({type:ge,id:me,duration:v}))},Re=function(e){o("ad-started"),f=e.getAd(),h.style.display="block",!0===f.isUiDisabled()?(ce=!0,Ze(x),R.style.bottom="",R.style.height="100%",G&&Ze(O)):(ce=!1,R.style.bottom="0",R.style.height="47px",G&&($e(O),Ze(x))),ue=!1,d.dispatchEvent({type:ge,id:"adStarted"}),$e(T),Je(),Ze(N),-1==k.className.indexOf("ads_pauseButton")&&ze(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),nt(),E=setInterval(nt,250),f.isSkippable()&&ce?(qe(),y=setInterval(tt,250)):Ke()},xe=function(e){d.dispatchEvent({type:ge,id:"adImpression"})},Ue=function(e){o("ad-complete"),d.datastore.set({name:"adsPlaying",data:!1}),d.dispatchEvent({type:ge,id:"adEnded"}),Ge()},He=function(e){ue||Ge()},Fe=function(){!1===d.paused&&d.pause()},Ve=function(e){o("ad-all-complete"),ue||(ie||Ge(),F&&(o("ad-manager-destroy"),F.destroy()),te=!0,d.datastore.set({name:"adsPlaying",data:!1}),d.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"}))},je=function(e){o("ad-error");var t=e.getError(),n=t.getErrorCode(),a=t.getInnerError(),i=0;a&&a.getErrorCode&&(i=a.getErrorCode()),d.dispatchEvent({type:ge,id:pe,code:t.getErrorCode(),msg:t.getMessage()}),n===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED||i===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(ue=!0,Ge(),d.stop(),X=!(Z=!0),Pe()):(Ge(),Ve())},Ge=function(e){ie||($e(T),mt(),Xe(),Ye(),$e(N),clearInterval(E),clearInterval(y),d.pauseAt([]),e?F&&(o("ad-manager-destroy2"),F.destroy()):ne||d.play(!0),ie=!0)},We=function(){J||yt()},ze=function(e,t,n,a,i,o,s){e.className=t,e.title=n;var d=e.getElementsByClassName("ads_hiddenElement")[0];d&&(d.innerHTML=n);var l=e.getElementsByTagName("svg")[0];l.setAttribute("width",a),l.setAttribute("height",i),l.setAttribute("viewBox",o);var r=e.getElementsByTagName("use")[0];r&&r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s)},qe=function(){w.style.display="block",M.style.display="block",I.style.display="none"},Ke=function(){w.style.display="none",M.style.display="none",I.style.display="none"},Ye=function(){A&&(A.style.display="none",h.style.display="none"),d.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},Qe=function(){d.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),A&&(A.style.display="block",Ce())},Ze=function(e){e&&(e.style.display="block")},$e=function(e){e&&(e.style.display="none")},Xe=function(){R&&(R.style.display="none",B.style.display="none")},Je=function(){R&&(R.style.display="block",B.style.display="block")},et=function(){(T=document.createElement("div")).id="ads_spinner",T.style.width="62px",T.style.height="62px",T.style.marginLeft="-31px",T.style.marginTop="-31px",T.style.top="50%",T.style.left="50%",T.style.display="none";var e=document.createElement("canvas"),t=new Sonic(e);t.width=50,t.height=50,t.colour=l,t.thickness=10,t.draw(),T.appendChild(e),h.appendChild(T)},tt=function(){var e=f.getDuration()-F.getRemainingTime();0<(Y=Math.ceil(f.getSkipTimeOffset()-e))?D.innerText="Skip ad in "+Y:(I.style.display="block",M.style.display="none",clearInterval(y))},nt=function(){var e=F.getRemainingTime();re||v<e&&(v=e,re=!0);var t=(v-e)/v;if(P.innerHTML=at(e),!(L.clientWidth<50||isNaN(t))){var n=100*t;S.style.width=n+"%"}},at=function(e){(e=Math.round(e))<0&&(e=0);var t=e/60,n=Math.floor(t%60),a=Math.floor(e%60);return a<10&&(a="0"+a),[n,a].join(":")},it=function(e,t,n,a){for(var i="object"==typeof t?t:t.split(/\s+/g),o=0;o<i.length;o++)e.addEventListener(i[o],n,a)},ot=function(e){this.style.backgroundColor=l,this.style.fill=r},st=function(e){this.style.backgroundColor="",this.style.fill=""},dt=function(e){this.style.border="1px solid rgba(255,255,255,1)",this.style.borderRight="0"},lt=function(e){this.style.border="1px solid rgba(255,255,255,0.5)",this.style.borderRight="0"},rt=function(e){e.stopPropagation(),Y<=0&&F.skip()},ut=function(e){se||(se=!0,c=setTimeout(function(){se=!1},500),G?"fadedOut"===R.className?pt():mt():(J||yt(),F.clicked()))},ct=function(e){G||pt()},gt=function(e){G||mt()},pt=function(){R.className="fadedIn",k.style.pointerEvents="auto",C.style.pointerEvents="auto",I.style.pointerEvents="auto",_.style.pointerEvents="auto"},mt=function(){R.className="fadedOut",k.style.pointerEvents="none",C.style.pointerEvents="none",I.style.pointerEvents="none",_.style.pointerEvents="none"},vt=function(e){se||(se=!0,c=setTimeout(function(){se=!1},500),F.clicked())},Et=function(){se||(se=!0,c=setTimeout(function(){se=!1},500),ee?(ze(_,"ads_muteButton","Mute","44","44","0 0 44 44","audio"),F.setVolume(1)):(ze(_,"ads_unmuteButton","UnMute","44","44","0 0 44 44","mute"),F.setVolume(0)),ee=!ee)},yt=function(e){se||(se=!0,c=setTimeout(function(){se=!1},500),J?(ze(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),F.resume(),E=setInterval(nt,250),f.isSkippable&&0<Y&&ce&&(y=setInterval(tt,250))):(ze(k,"ads_playButton","Play","31","31","0 0 44 44","play"),F.pause(),clearInterval(E),clearInterval(y)),J=!J)},ft=function(){se||(se=!0,c=setTimeout(function(){se=!1},500),d.toggleFullscreen())},At=function(){clearTimeout(u),d.updateUiConfig({cta:{enabled:!0}})},ht=function(){for(var e=0;e<q.length;e++)"PreviewPluginHTML"===q[e].id&&(de=!0)};return{pluginInitialisation:function(e){o("ad-plugin-init"),d=e.playerInterface,function(){var e={id:"dfpAds",version:"4.7.1"},t=d.datastore.get("plugins");if(t){var n=t.slice();n.push(e),q=n}else q=[e];d.datastore.set({name:"plugins",data:q.slice()}),ht()}(),d.listenerObject={pluginLoaded:Ee};var t=d.datastore.get("AdsPluginParameters");t=t||{},d.updateUiConfig({cta:{enabled:!1}}),e.loadCSS(t.cssPath?t.cssPath:"../css/dfpAds.css"),W=!!t.pretendPlaylistHasAds,a=t.adTag,z=!!t.debug,l=d.settings.ui.colour,r=d.settings.ui.foreColour,Q="function"==typeof t.setupCompanionAds?t.setupCompanionAds:function(){},function(){o("ad-create-ux"),A=i("div","ads_adsUX",d.container),it(A,"mouseenter focus",ct),it(A,"mouseleave blur",gt),b=i("div","ads_adContainer",A),(h=i("div","ads_customUI",A)).style.display="none",et(),(R=i("div","ads_controlsContainer",h)).className="fadedOut",B=i("div","ads_bottomFade",R),x=i("div","ads_clickDiv",h),it(x,"touchend click mouseup",ut),$e(x),L=i("div","ads_seekBar",R),(S=i("div","ads_progressBar",L)).style.backgroundColor=l;var e=i("div","ads_buttonBar",R);k=s("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),it(k,"touchend click mouseup",yt),it(k,"mouseenter focus",ot),it(k,"mouseleave blur",st),e.appendChild(k),_=s("ads_volumeButton","ads_audioButton","Mute","44","44","0 0 44 44","audio"),it(_,"touchend click mouseup",Et),it(_,"mouseenter focus",ot),it(_,"mouseleave blur",st),e.appendChild(_),C=s("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),it(C,"touchend click mouseup",ft),it(C,"mouseenter focus",ot),it(C,"mouseleave blur",st),e.appendChild(C),w=i("div","ads_skipContainer",h),I=i("button","ads_skipButton",w),i("div","ads_skipButtonText",I).innerHTML+="Skip Ad";i("div","ads_skipButtonIcon",I);it(I,"touchend click mouseup",rt),it(I,"mouseenter focus",dt),it(I,"mouseleave blur",lt),M=i("div","",w),(D=i("div","ads_skipText",M)).innerHTML+="Skip ad in ",G&&(O=i("div","ads_learnmore",h),it(O,"touchend click mouseup",vt),O.innerHTML+="Learn More",$e(O)),N=i("div","ads_countdownText",h),$e(N);var t=i("span","",N),n={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"};n[K=d.settings.ui.locale.lang]&&(K=n[K]);var a=ve[K]?ve[K]:ve.en;t.innerHTML=a+" ",(P=i("span","",N)).innerHTML="0:00",o("ad-create-ux-complete")}(),u=setTimeout(function(){At()},5e3),function(e){if(o("ad-sdk-load"),window.google&&window.google.ima)e();else{var t=document.createElement("script");t.async=!0,t.type="text/javascript",t.onload=function(){e()},t.src=document.location.protocol+(!0===z?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(t)}}(n)},reset:function(){clearTimeout(c),clearTimeout(g),clearTimeout(u),he()}}}();var runPlugin=function(e,t){return e.register({name:"dfpAds.js"}),AdsPlugin};